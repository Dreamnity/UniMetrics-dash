<!DOCTYPE html>
<html>
	<head>
		<script src="node_modules/gridstack/dist/gridstack-all.js"></script>
		<link
			href="node_modules/gridstack/dist/gridstack.min.css"
			rel="stylesheet"
		/>
		<style type="text/css">
			.grid-stack {
				background: #fafad2;
			}
			.grid-stack-item-content {
				background-color: #18bc9c00;
			}
			iframe {
				width: 100%;
				height: 95%;
				pointer-events: unset;
			}
			iframe:hover {
				pointer-events: none;
			}
		</style>
		<meta charset="UTF-8" />
		<title>UniMetrics</title>
	</head>
	<body>
		<div class="grid-stack">
			<div class="grid-stack-item" gs-h="5" gs-w="5">
				<div class="grid-stack-item-content">
					<iframe
						id="frame"
						src="about:blank"
						frameborder="0"
						scrolling="no"
						class="viewer"
						data-name="test"
					></iframe>
				</div>
			</div>
			<div class="grid-stack-item" gs-h="3" gs-w="5">
				<div class="grid-stack-item-content">
					<iframe
						id="frame"
						src="about:blank"
						frameborder="0"
						scrolling="no"
						class="viewer"
						data-name="test"
					></iframe>
				</div>
			</div>
			<div class="grid-stack-item" gs-w="2">
				<div class="grid-stack-item-content">Item 2 wider</div>
			</div>
		</div>
		<script type="text/javascript">
			var grid = GridStack.init();
			grid.load(localStorage.getItem("layout") || []);
			const token = "MWhqcmIzMnVsLmQ0Zw";
			/**
			 * @param {Element} element
			 */
			function constructSrc(element) {
				localStorage.getItem(
					"grid" + (name = element.getAttribute("data-name"))
				);
				element.src =
					"viewer.html?" +
					new URLSearchParams({
						token,
						name,
						width: element.parentElement.clientWidth, // * 0.8,
						height: element.parentElement.clientHeight, // * 0.8,
					}).toString();
			}
			document.addEventListener("DOMContentLoaded", () => {
				for (const element of document.getElementsByClassName("viewer")) {
					constructSrc(element);
				}
			});
			grid.on(
				"resizestop",
				/**
				 * @param {Event} event
				 * @param {Element} el
				 */
				function (event, el) {
					console.log(event, el.clientHeight - 28);
					const frame = [
						...[...el.childNodes.values()]
							.find(e => e.className === "grid-stack-item-content")
							.childNodes.values(),
					].find(e => e.className === "viewer");
					console.log(frame);
					frame.clientHeight = el.clientHeight - 28;
					frame.clientWidth = el.clientWidth - 28;
					constructSrc(frame);
				}
			);
		</script>
	</body>
</html>
